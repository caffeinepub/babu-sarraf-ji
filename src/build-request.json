{
  "kind": "build_request",
  "title": "Use authenticated profile name/photo consistently across Community and Test History",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-96",
      "text": "Update the user identity model so the app can store and return an authenticated user profile for a principal, including: (1) display name, (2) optional email, and (3) optional profile photo URL, with a clear fallback order for display name: authenticated display name → authenticated email → short principal.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Show user’s real name from Google (Gmail) account.",
          "If Google name is not available, fallback to registered email."
        ]
      },
      "acceptanceCriteria": [
        "The backend exposes a user profile shape that includes a display name plus optional email and optional profile photo URL for a user principal.",
        "There is a deterministic, documented fallback order used by the frontend for name display: displayName → email → short principal.",
        "Existing community post/comment/chat and test history APIs continue to work (no breaking Candid changes without a migration strategy)."
      ]
    },
    {
      "id": "REQ-97",
      "text": "Remove support for user-supplied/custom usernames in the UI and ensure the displayed name and avatar are sourced only from the authenticated profile data (or fallbacks), with no manual editing controls anywhere in the app.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Do not allow custom username.",
          "No manual editing of name allowed."
        ]
      },
      "acceptanceCriteria": [
        "There is no input, modal, settings panel, or editable UI that allows setting or changing a username/display name.",
        "Any existing display-name helper logic is updated to read from the authenticated profile fields and apply the fallback order (name → email → short principal).",
        "All user-facing text remains English."
      ]
    },
    {
      "id": "REQ-98",
      "text": "Automatically sync/load the authenticated profile after login so the correct name and profile photo are available without manual steps, and ensure the profile is used consistently in Community (posts, comments, chat) and in Test History.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Name should automatically load after login.",
          "Same name should show in: Chat, Comments, Posts, Test history"
        ]
      },
      "acceptanceCriteria": [
        "After a successful Internet Identity login, the app triggers a profile sync/load flow and the UI updates to show the best available display name without requiring a refresh.",
        "Community feed items (posts), comments, and chat messages all show the same resolved author name for a given principal.",
        "Test History shows the signed-in user identity (resolved name and photo if available) in a consistent place (e.g., header area) without altering stored result rows or breaking existing history rendering.",
        "If profile photo URL is missing, the UI renders a clean fallback avatar (e.g., initial/circle) without layout shift."
      ]
    },
    {
      "id": "REQ-99",
      "text": "Update Community chat, comments, and post headers to display: profile photo (if available), bold display name, timestamp, and message/content below the name, with a clean layout that is dark-mode compatible and does not change other Community behaviors (posting, liking, moderation, polling).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Display: Real Name (from Gmail) Profile photo (Google account DP) Timestamp",
          "Design: Clean layout Name bold Message below name Dark mode compatible Do not disturb other features."
        ]
      },
      "acceptanceCriteria": [
        "Chat message rows display an avatar next to the author block, author name is visually bold, timestamp is present, and message text renders below the name line.",
        "Comment items display an avatar (when available), bold author name, timestamp, and comment content below.",
        "Post header displays the author avatar (when available), bold author name, and timestamp; existing admin actions (delete/block) remain unchanged.",
        "All updated layouts look correct in both dark and light modes and remain mobile-friendly.",
        "No changes to Streamer Mode behavior or /timer UI occur as a result of these updates."
      ]
    }
  ],
  "constraints": [
    "Authentication must remain Internet Identity-based (no Google/Firebase/Auth0 OAuth integration).",
    "Do not edit files under frontend/src/components/ui or any frontend immutablePaths listed in SYSTEM_CONTEXT.",
    "Use English for all user-facing text.",
    "Do not introduce new real-time transport (no WebSockets); keep existing polling/react-query patterns.",
    "Do not disturb existing Community moderation permissions; enforce permissions on the backend as currently implemented."
  ],
  "nonGoals": [
    "Implementing Google Authentication / fetching Gmail profile data directly from Google APIs.",
    "Allowing users to manually set or edit a username/display name.",
    "Changing the Community data model for posts/comments/chat beyond adding/reading profile metadata.",
    "Redesigning the overall site theme or modifying Pomodoro/NCERT/Daily Target behaviors."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}