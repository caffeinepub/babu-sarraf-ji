{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Update user profile display to show Google account name and photo across Community and add Study Room link",
  "requirements": [
    {
      "id": "REQ-100",
      "summary": "Remove support for user-supplied/custom usernames in the UI and ensure the displayed name and avatar are sourced only from the authenticated profile data (or fallbacks), with no manual editing controls anywhere in the app",
      "acceptanceCriteria": [
        "All UI components that previously allowed username editing are removed or disabled",
        "Display name is derived exclusively from authenticated profile data",
        "No text input or edit controls for username exist anywhere in the app"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/user/ProfileSetupModal.tsx",
          "operation": "delete",
          "description": "Remove the ProfileSetupModal component entirely as it previously allowed custom username entry. Profile data will now be automatically synced from authentication."
        },
        {
          "path": "frontend/src/components/AppLayout.tsx",
          "operation": "modify",
          "description": "Remove any references to ProfileSetupModal and eliminate the profile setup flow that prompted users for a custom username. Keep the AuthProfileBootstrapper for automatic profile sync."
        },
        {
          "path": "frontend/src/lib/userIdentity.ts",
          "operation": "modify",
          "description": "Update getUserDisplayName and getUserInitials helpers to always derive from authenticated profile data (displayName field) with fallbacks to 'User' or email/principal truncation. Remove any logic that supported custom usernames."
        }
      ]
    },
    {
      "id": "REQ-101",
      "summary": "Automatically sync/load the authenticated profile after login so the correct name and profile photo are available without manual steps, and ensure the profile is used consistently in Community (posts, comments, chat) and in Test History",
      "acceptanceCriteria": [
        "Profile data is fetched automatically after successful Internet Identity login",
        "Profile name and photo are immediately available for use across all features",
        "Community posts, comments, and chat messages display the authenticated profile data",
        "Test History displays the authenticated profile data"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/user/AuthProfileBootstrapper.tsx",
          "operation": "modify",
          "description": "Ensure the component automatically calls getCallerUserProfile after authentication and stores the profile in React Query cache. If no profile exists, create a default profile with displayName derived from the identity. Ensure profile includes displayName and optional photoUrl fields."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Update useGetCallerUserProfile to properly handle the automatic profile sync. Ensure it returns isLoading, isFetched, and profile data correctly. Add dependency on actor availability to prevent premature queries."
        },
        {
          "path": "frontend/src/hooks/community/useUserProfiles.ts",
          "operation": "modify",
          "description": "Update useGetUserDisplayName to use the displayName and photoUrl from UserProfile when available. Ensure it handles missing profiles gracefully with fallbacks."
        }
      ]
    },
    {
      "id": "REQ-102",
      "summary": "Update Community chat, comments, and post headers to display: profile photo (if available), bold display name, timestamp, and message/content below the name, with a clean layout that is dark-mode compatible and does not change other Community behaviors (posting, liking, moderation, polling)",
      "acceptanceCriteria": [
        "Chat messages show profile photo (when available), bold display name, timestamp, and message content below",
        "Comments show profile photo (when available), bold display name, timestamp, and comment text below",
        "Post headers show profile photo (when available), bold display name, and timestamp",
        "Layout is clean, properly spaced, and works in both dark and light modes",
        "Existing Community features (posting, liking, deleting, moderation) continue to work unchanged"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/community/ChatPanel.tsx",
          "operation": "modify",
          "description": "Refactor message rendering to display UserAvatar (using photoUrl from profile), bold displayName, timestamp, and message content below the name. Use flexbox or grid for clean layout. Ensure dark-mode compatible styling using Tailwind theme variables. Preserve admin delete functionality."
        },
        {
          "path": "frontend/src/components/community/CommentsSection.tsx",
          "operation": "modify",
          "description": "Update comment rendering to show UserAvatar (using photoUrl from profile), bold displayName, timestamp, and comment text below. Maintain clean spacing and dark-mode compatibility. Keep admin delete controls unchanged."
        },
        {
          "path": "frontend/src/components/community/PostCard.tsx",
          "operation": "modify",
          "description": "Revise post header to display UserAvatar (using photoUrl from profile), bold displayName, and timestamp. Ensure layout is clean, properly spaced, and dark-mode compatible. Preserve all existing features: image display, caption, likes, comments toggle, and admin controls."
        },
        {
          "path": "frontend/src/components/user/UserAvatar.tsx",
          "operation": "modify",
          "description": "Update UserAvatar component to accept and render photoUrl from UserProfile when available. If no photoUrl, fall back to initials. Ensure the component is reusable for posts, comments, chat, and test history with consistent sizing and styling."
        }
      ]
    },
    {
      "id": "REQ-103",
      "summary": "Add a new navbar navigation entry labeled exactly 'Study Room' with a video camera icon (ðŸŽ¥ or ðŸ“¹ style) that opens the Google Meet link https://meet.google.com/fzn-cjad-ofe in a new tab",
      "acceptanceCriteria": [
        "A new 'Study Room' entry appears in the top navbar with a video camera icon",
        "Clicking the Study Room entry opens the Google Meet link in a new browser tab",
        "The navbar entry is styled consistently with other navbar items",
        "The Study Room entry does not break existing navbar behavior or Streamer Mode navbar hiding"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/SiteNav.tsx",
          "operation": "modify",
          "description": "Add a new 'Study Room' navigation button with a video camera icon (ðŸŽ¥ or ðŸ“¹ emoji or SVG). When clicked, trigger the confirmation popup (see REQ-104). Do not directly open the link here; instead, call a handler that shows the confirmation dialog. Style the button consistently with other nav items and ensure it hides correctly in Streamer Mode on the timer page."
        }
      ]
    },
    {
      "id": "REQ-104",
      "summary": "Show a confirmation popup before redirecting to the Google Meet link with the message 'You are joining Focus Babu Study Room.' and provide options to proceed or cancel",
      "acceptanceCriteria": [
        "When the user clicks the Study Room navbar entry, a confirmation dialog appears",
        "The dialog displays the exact message: 'You are joining Focus Babu Study Room.'",
        "The dialog provides clear 'Proceed' and 'Cancel' buttons",
        "Clicking 'Proceed' opens the Google Meet link in a new tab",
        "Clicking 'Cancel' closes the dialog without navigation",
        "The confirmation dialog styling matches the app's clean study-vibe design and is dark-mode compatible"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/studyRoom/StudyRoomConfirmDialog.tsx",
          "operation": "create",
          "description": "Create a reusable confirmation dialog component using shadcn/ui Dialog. Display the message 'You are joining Focus Babu Study Room.' and show the description from REQ-105. Provide 'Proceed' and 'Cancel' buttons. On 'Proceed', open https://meet.google.com/fzn-cjad-ofe in a new tab using window.open. Ensure styling is clean, matches the app's study-vibe aesthetic, and is dark-mode compatible using Tailwind theme variables."
        },
        {
          "path": "frontend/src/components/SiteNav.tsx",
          "operation": "modify",
          "description": "Import and integrate StudyRoomConfirmDialog. Add state to control dialog visibility. When the Study Room nav button is clicked, open the confirmation dialog instead of directly navigating. Pass the dialog state handlers to the StudyRoomConfirmDialog component."
        }
      ]
    },
    {
      "id": "REQ-105",
      "summary": "Add a small description section on the Study Room page or in the confirmation dialog that reads: 'Join live group study session and stay focused together.'",
      "acceptanceCriteria": [
        "The description text 'Join live group study session and stay focused together.' is displayed in the confirmation popup or on a dedicated Study Room page",
        "The text is clearly visible and properly styled",
        "The description fits the clean study-vibe aesthetic and is dark-mode compatible"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/studyRoom/StudyRoomConfirmDialog.tsx",
          "operation": "modify",
          "description": "Add the description text 'Join live group study session and stay focused together.' below the main confirmation message. Use a muted text style for the description to differentiate it from the main message. Ensure proper spacing and dark-mode compatibility."
        }
      ]
    },
    {
      "id": "REQ-106",
      "summary": "Ensure the Study Room feature (navbar entry, confirmation popup, and link redirect) is fully responsive, mobile-friendly, and matches the existing clean study-vibe design with dark-mode compatibility",
      "acceptanceCriteria": [
        "The Study Room navbar entry is properly sized and positioned on mobile devices",
        "The confirmation popup is responsive and displays correctly on all screen sizes",
        "All Study Room UI elements work correctly in both dark and light modes",
        "The feature does not introduce any visual inconsistencies with the existing app design"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/studyRoom/StudyRoomConfirmDialog.tsx",
          "operation": "modify",
          "description": "Ensure the confirmation dialog uses responsive Tailwind classes (e.g., max-w-sm, w-full, p-4) for mobile compatibility. Test that the dialog scales properly on small screens and that buttons are touch-friendly. Verify dark-mode styling using theme variables."
        },
        {
          "path": "frontend/src/components/SiteNav.tsx",
          "operation": "modify",
          "description": "Ensure the Study Room nav button is properly sized for mobile devices. Use responsive Tailwind classes and test on small screens. Verify the icon and label are readable and the button is touch-friendly. Ensure dark-mode compatibility using theme variables."
        }
      ]
    }
  ]
}